<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="author" content="inaship">
    <meta name="copyright" content="inaship">
    <meta name="description" content="個人的なテストの場">
    <meta name="keywords" content="">
    <meta name=”robots” content=”noindex,follow” />
    <!--<base href="http://inaship.github.com/">-->
    <link rel="stylesheet" type="text/css" href="../assets/css/style.css" />
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <title>SGT6-APP - Index</title>
    <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <script type="text/javascript">
      var sgtLW;  // 設定用変数
      var apiDomain;
      var authtext;
      // 外部ファイル読み込み
      function loadSetting(){
        $.ajaxSetup({async: false});
        $.getJSON("setting.json", function(json){
          sgtLW = json;
          apiDomain = sgtLW.api_domain;
          authtext = sgtLW.auth_pass;
        })
        $.ajaxSetup({async: true});
      }

      var apParam = {
        //swPoint: "35.3682,138.9374",
        //nePoint: "35.3679,138.9191",
        swPoint: "36.1769,138.9866",
        nePoint: "36.4369,139.4398",
        jisCode_city: "10204",
        element: ""
      }

      var apiUrl = {
        "矩形指定データ-1": "/v1/area/real/rectangle",        // 0
        "都道府県指定データ": "/v1/area/real/ja/prefecture",   // 1
        "市町村指定データ": "/v1/area/real/ja/city",          // 2
        "POTEKA指定データ": "/v1/point/real/ja/poteka",     // 3
        "アメダス指定データ": "/v1/area/point/ja/amedas",     // 4
        "雨雲レーダー指定データ": "/v1/area/point/ja/radar",   // 5
        "矩形指定データ-2": "/v1/area/forecast/rectangle"    // 6
      }

      // 天気情報読み込みテスト
      function getWatherJSON() {
        $('#dispArea').val();
        var req = new XMLHttpRequest();
        req.onreadystatechange = function() {
          if(req.readyState == 4 && req.status == 200){ // サーバーからのレスポンスが完了し、かつ、通信が正常に終了した場合
            $('#dispArea').val(req.responseText);
          }
        };

        //var reqUrl = apiDomain + "/v1/area/real/rectangle?swPoint=" + apParam["swPoint"] + "&" + apParam["nePoint"] + "&element=" + $("#selectedElement").val(); // 'Access-Control-Allow-Origin'で取得できない
        var reqUrl = apiDomain + "/v1/area/real/ja/city?jisCode=" + apParam["jisCode_city"] + "&element=" + $("#selectedElement").val();  // 取得できる
        //var reqUrl = apiDomain + "/v1/area/real/ja/prefecture?jisCode=09,10&element=" + $("#selectedElement").val(); // 取得できる
        //var reqUrl = apiDomain + "/v1/point/real/ja/poteka?potekaId=235&element=" + $("#selectedElement").val();  // 取得できる
        //var reqUrl = apiDomain + "/v1/point/real/ja/amedas?amedasId=42302&element=" + $("#selectedElement").val();  // 取得できる
        //var reqUrl = apiDomain + "/v1/point/real/ja/radar?zoomLevel=10&x=429&y=218&datetime=2015-11-26T19:30:00+00:00" ; // 400 (Bad Request)で取得できない
        //var reqUrl = apiDomain + "/v1/point/real/ja/amedas?amedasId=42302&element=" + $("#selectedElement").val(); // 取得できる
        //var reqUrl = apiDomain + "/v1/area/forecast/rectangle?swPoint=36.1769,138.9866&nePoint=36.4369,139.4398&element=" + $("#selectedElement").val(); // 'Access-Control-Allow-Origin'で取得できない

        /*
        var reqUrl = apiDomain
                   + apiUrl["矩形指定データ-2"]
                   + "?"
                   + "swPoint=" + apParam["swPoint"] + "&"
                   + "nePoint=" + apParam["nePoint"] + "&"
                   + "element=" + $("#selectedElement").val();
        */
        req.open("GET", reqUrl, false);
        req.setRequestHeader("X-POTEKA-Authorization", authtext);
        req.send(null);
      }

      // 取得する情報を選択するセレクトボックスを生成
      function setSelectedElement() {
        var elementValue = {
          temp: "気温",
          humi: "湿度",
          press_l: "現地気圧",
          press_s: "海面気圧",
          wind_d: "風向",
          wind_s: "風速",
          solar: "日射",
          rain: "雨感",
          rain_f: "1時間雨量",
          rain_i: "降水強度",
          rain_c: "連続雨量",
          rain_e: "実効雨量",
          wbgt: "暑さ指数",
          weather: "天気"
        },
        $select = $('#selectedElement'),
        $option,
        options,
        isSelected;
        // コールバック関数の引数の順序が $.each と異なることに注意。
        options = $.map(elementValue, function (name, value) {
          isSelected = (value === 'temp');
          $option = $('<option>', { value: value, text: name, selected: isSelected });
          return $option;
        });
        $select.append(options);
      }

      // パラメーターチェック
      function checkParam() {
        $('#dispParam').val(apParam["swPoint"].text);
      }

      // チェックしたエレメントを取得
      var elements;
      function getCheckElements() {
        elements = $('[class="elements"]:checked').map(function(){
          return $(this).val()
        }).get().join(',');
        console.log(elements);
        opElements();
      }
      function opElements(){
        alert(elements);
      }

      // イニシャライズ
      $(function () {
        loadSetting();
        // setSelectedElement();
      });
    </script>
  </head>
  <body>
    <div id="wapper">
      <div id="container">
        <div>SGT</div>
        <div>
          <input type="checkbox" name="elementType" class="elements" value="temp" checked="checked">&nbsp;気温
          <input type="checkbox" name="elementType" class="elements" value="humi">&nbsp;湿度
          <input type="checkbox" name="elementType" class="elements" value="press_l">&nbsp;現地気圧
          <input type="checkbox" name="elementType" class="elements" value="press_s">&nbsp;海面気圧
          <input type="checkbox" name="elementType" class="elements" value="wind_d">&nbsp;風向
          <input type="checkbox" name="elementType" class="elements" value="wind_s">&nbsp;風速
          <input type="checkbox" name="elementType" class="elements" value="solar">&nbsp;日射
          <input type="checkbox" name="elementType" class="elements" value="rain">&nbsp;雨感
          <input type="checkbox" name="elementType" class="elements" value="rain_f">&nbsp;1時間雨量
          <input type="checkbox" name="elementType" class="elements" value="rain_i">&nbsp;降水強度
          <input type="checkbox" name="elementType" class="elements" value="rain_c">&nbsp;連続雨量
          <input type="checkbox" name="elementType" class="elements" value="wbgt">&nbsp;暑さ指数
          <input type="checkbox" name="elementType" class="elements" value="weather">&nbsp;天気
        </div>
        <div>
            <button onclick="getCheckElements();">チェックされた要素を確認</button>
        </div>
        <div>
          <button onclick="getWatherJSON();">天気データを取得して表示</button>
        </div>
        <div><textarea id="dispArea" rows="50" cols="50"></textarea></div>
      </div>
      <footer>
        <p>&nbsp;</p>
      </footer>
    </div>
  </body>
</html>